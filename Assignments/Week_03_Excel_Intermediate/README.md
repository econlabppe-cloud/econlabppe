# שבוע 3 – Excel בינוני: VLOOKUP, Pivot Tables, וגרפים לפרסום


### 🎥 סרטוני הדרכה לפרק זה
כדי לכסות את החומר מכל הזוויות, ריכזנו עבורכם 3 סרטונים ברמות קושי שונות:
::: {.panel-tabset}
## 🟢 רמת מתחילים
**מבוא והיכרות עם המושגים הבסיסיים:**
{{< video [https://www.youtube.com/watch?v=m0wI61ahfvY](https://www.youtube.com/watch?v=m0wI61ahfvY) >}}
## 🟡 רמת ביניים
**העמקה ופרקטיקה מעשית:**
{{< video [https://www.youtube.com/watch?v=igSovq_H24A](https://www.youtube.com/watch?v=igSovq_H24A) >}}
## 🔴 רמת מתקדמים
**מקרי קצה, אופטימיזציה ושימושים מורכבים:**
{{< video [https://www.youtube.com/watch?v=sUxrA8NIVK0](https://www.youtube.com/watch?v=sUxrA8NIVK0) >}}
:::



## 🟢 רמת מתחילים
**מבוא והיכרות עם המושגים הבסיסיים:**
{{< video https://www.youtube.com/watch?v=m0wI61ahfvY >}}

## 🟡 רמת ביניים
**העמקה ופרקטיקה מעשית:**
{{< video https://www.youtube.com/watch?v=igSovq_H24A >}}

## 🔴 רמת מתקדמים
**מקרי קצה, אופטימיזציה ושימושים מורכבים:**
{{< video https://www.youtube.com/watch?v=sUxrA8NIVK0 >}}

:::
## מה נלמד השבוע?

| נושא | זמן משוער |
|---|---|
| VLOOKUP ו-INDEX/MATCH | 90 דקות |
| SUMIF, AVERAGEIF, COUNTIFS | 45 דקות |
| Conditional Formatting | 30 דקות |
| Data Validation | 30 דקות |
| Pivot Tables מלאות | 90 דקות |
| Slicers ו-Timelines | 30 דקות |
| גרפים מקצועיים | 60 דקות |
| **סה"כ** | **~7 שעות** |

---

## הנתונים שנעבוד איתם

הורד / הכן **שני** קבצי נתונים:

**קובץ 1: `macro_annual.xlsx`** – נתוני מאקרו שנתיים (המשך משבוע 2)

**קובץ 2: `districts_quarterly.xlsx`** – נתוני מחוזות לפי רבעון:

| רבעון | מחוז | תוצר מחוזי (מיליארד ₪) | אבטלה % | שכר ממוצע (₪) |
|---|---|---|---|---|
| 2022-Q1 | תל אביב | 320 | 3.2 | 14,500 |
| 2022-Q1 | ירושלים | 180 | 5.1 | 11,200 |
| 2022-Q1 | חיפה | 145 | 4.8 | 12,100 |
| 2022-Q1 | צפון | 95 | 6.2 | 9,800 |
| 2022-Q1 | דרום | 88 | 7.1 | 9,200 |
| 2022-Q2 | תל אביב | 335 | 3.0 | 14,800 |
| 2022-Q2 | ירושלים | 185 | 4.9 | 11,400 |
| 2022-Q2 | חיפה | 148 | 4.5 | 12,300 |
| 2022-Q2 | צפון | 97 | 6.0 | 9,900 |
| 2022-Q2 | דרום | 90 | 6.9 | 9,300 |
| 2022-Q3 | תל אביב | 340 | 2.8 | 15,000 |
| 2022-Q3 | ירושלים | 188 | 4.7 | 11,600 |
| 2022-Q3 | חיפה | 150 | 4.3 | 12,500 |
| 2022-Q3 | צפון | 99 | 5.8 | 10,000 |
| 2022-Q3 | דרום | 92 | 6.7 | 9,400 |
| 2022-Q4 | תל אביב | 328 | 3.1 | 14,700 |
| 2022-Q4 | ירושלים | 183 | 5.0 | 11,300 |
| 2022-Q4 | חיפה | 146 | 4.6 | 12,200 |
| 2022-Q4 | צפון | 96 | 6.1 | 9,850 |
| 2022-Q4 | דרום | 89 | 7.0 | 9,250 |
| 2023-Q1 | תל אביב | 315 | 3.5 | 14,900 |
| 2023-Q1 | ירושלים | 178 | 5.3 | 11,500 |
| 2023-Q1 | חיפה | 142 | 5.0 | 12,400 |
| 2023-Q1 | צפון | 93 | 6.5 | 9,950 |
| 2023-Q1 | דרום | 86 | 7.4 | 9,350 |

*(הכן נתוני 2023 Q2-Q4 בדומה – תוכל להמציא ערכים סבירים)*

---

## חלק א – VLOOKUP: חיפוש נתונים בטבלה

### מה זה VLOOKUP?

דמיין שיש לך **שתי טבלאות** ואתה רוצה "לתפור" ביניהן לפי ערך משותף.

**מבנה:**
```excel
=VLOOKUP(lookup_value, table_array, col_index_num, [range_lookup])
```

| פרמטר | הסבר |
|---|---|
| `lookup_value` | הערך שמחפשים |
| `table_array` | הטבלה שמחפשים בה |
| `col_index_num` | מספר העמודה שרוצים להחזיר |
| `range_lookup` | **FALSE** = חיפוש מדויק (כמעט תמיד זה מה שצריך) |

### דוגמה: מחירי דיור לפי מחוז

נניח שיש לך טבלה של מחירי דיור לפי מחוז:

```
A        B
מחוז     מחיר ממוצע (₪)
תל אביב  4,200,000
ירושלים  2,800,000
חיפה     1,900,000
צפון     1,200,000
דרום     1,100,000
```

ובטבלת `districts_quarterly` רוצה להוסיף עמודת מחיר דיור לכל מחוז:

```excel
=VLOOKUP(B2, $H$1:$I$5, 2, FALSE)
```

כאשר B2 = שם המחוז, $H$1:$I$5 = הטבלה השנייה.

**שים לב:**
- הטבלה חייבת להיות ממויינת לפי עמודת החיפוש (לחיפוש מדויק – לא חייב)
- VLOOKUP מחפש **בעמודה הראשונה** של הטבלה
- לא יכול להחזיר נתונים מעמודות **שמשמאל** לעמודת החיפוש

### VLOOKUP – שגיאות נפוצות

| שגיאה | סיבה | פתרון |
|---|---|---|
| `#N/A` | הערך לא נמצא | בדוק איות, רווחים מיותרים |
| `#REF!` | col_index גדול ממספר העמודות | הקטן את col_index |
| ערך שגוי | range_lookup=TRUE בטעות | שנה ל-FALSE |

---

## חלק ב – INDEX/MATCH: הגרסה המתקדמת

INDEX/MATCH עושה את אותו הדבר כמו VLOOKUP אבל:
- יכול לחפש בכל כיוון (גם שמאלה!)
- מהיר יותר על טבלאות גדולות
- הרבה יותר גמיש

```excel
=INDEX(return_range, MATCH(lookup_value, lookup_range, 0))
```

**דוגמה:**

```excel
=INDEX($I$1:$I$5, MATCH(B2, $H$1:$H$5, 0))
```

- `MATCH` מוצא **איפה** B2 נמצא בעמודת המחוזות → מחזיר מספר שורה
- `INDEX` מחזיר את **הערך** באותה שורה מעמודת המחירים

> **כלל:** אם אתה מחפש ל**שמאל** של עמודת ה-key, חייב INDEX/MATCH. אחרת VLOOKUP גם עובד.

---

## חלק ג – SUMIF, AVERAGEIF, COUNTIFS

### SUMIF – סכום לפי תנאי

```excel
=SUMIF(range, criteria, sum_range)
```

**דוגמה:** סכום תוצר מחוזי **רק לתל אביב**:
```excel
=SUMIF(B:B, "תל אביב", C:C)
```

**דוגמה עם תנאי מספרי:** סכום תוצר מחוזות עם אבטלה > 5%:
```excel
=SUMIF(D:D, ">5", C:C)
```

### AVERAGEIF – ממוצע לפי תנאי

```excel
=AVERAGEIF(B:B, "ירושלים", E:E)
```
ממוצע שכר **רק בירושלים**.

### COUNTIFS – ספירה עם מספר תנאים

```excel
=COUNTIFS(D:D, ">5", C:C, ">100")
```
כמה רשומות יש עם אבטלה > 5% **וגם** תוצר > 100?

---

## חלק ד – Conditional Formatting: צבע שמספר סיפור

עיצוב מותנה = Excel **צובע תאים אוטומטית** לפי הערך שלהם.

### 1. Heat Map על עמודת אבטלה

1. סמן עמודת אבטלה (D2:D25)
2. Home → Conditional Formatting → Color Scales → בחר: ירוק-צהוב-אדום
   - ירוק = אבטלה נמוכה (טוב)
   - אדום = אבטלה גבוהה (רע)

### 2. Data Bars

1. סמן עמודת שכר ממוצע (E2:E25)
2. Home → Conditional Formatting → Data Bars
3. כל תא מציג "בר" יחסי לגודל הערך

### 3. כלל מותאם אישית

רוצה להדגיש שורות שלמות עם אבטלה קיצונית?

1. סמן כל הטבלה (A2:E25)
2. Home → Conditional Formatting → New Rule → "Use a formula"
3. הכנס: `=$D2>6`
4. בחר צבע רקע אדום
5. OK

עכשיו כל שורה עם אבטלה > 6% תאיר באדום!

---

## חלק ה – Data Validation: מניעת שגיאות הזנה

Data Validation מגבילה **מה אפשר להכניס לתא**.

### 1. רשימה נפתחת (Dropdown)

נניח שיש עמודה "מחוז" וצריך לבחור רק מ-5 מחוזות:

1. סמן תא / עמודה ריקה
2. Data → Data Validation
3. Allow: **List**
4. Source: `תל אביב,ירושלים,חיפה,צפון,דרום`
5. OK

עכשיו לחיצה על כל תא בעמודה מציגה dropdown!

### 2. מגבלת מספר

```
Allow: Decimal
Data: between
Minimum: -20
Maximum: 100
```

זה יחסום הזנת אינפלציה של 500% בטעות.

### 3. הודעת שגיאה מותאמת

בלשונית "Error Alert":
- Style: Stop
- Title: שגיאת הזנה
- Message: הכנס ערך בין -20 ל-100

---

## חלק ו – Pivot Tables: ניתוח נתונים בלחיצה

Pivot Tables הן הכלי **הכי חזק** ב-Excel לסיכום נתונים.

### מה Pivot Table עושה?

מטבלה של 25 שורות ו-5 עמודות → סיכום בכל חתך שתרצה, בשניות.

### יצירת Pivot Table ראשון

1. לחץ על תא כלשהו בטבלת `districts_quarterly`
2. Insert → PivotTable
3. בחר "New Worksheet" → OK

ייפתח **PivotTable Field List** מימין.

### מבנה ה-PivotTable

```
┌─────────────────────────────────┐
│ FILTERS:    [רבעון ▼]           │  ← סינון כלל הנתונים
│─────────────────────────────────│
│ COLUMNS:    [שנה]               │  ← עמודות הטבלה
│─────────────────────────────────│
│ ROWS:       [מחוז]              │  ← שורות הטבלה
│─────────────────────────────────│
│ VALUES:     [Sum of תוצר]       │  ← הערכים שמסכמים
└─────────────────────────────────┘
```

### Pivot 1: תוצר ממוצע לפי מחוז

- Rows: מחוז
- Values: תוצר מחוזי → לחץ על הערך → Value Field Settings → Average

**תוצאה:** טבלה שמציגה את ממוצע התוצר הרבעוני לכל מחוז.

### Pivot 2: שכר ממוצע לפי מחוז ורבעון

- Rows: מחוז
- Columns: רבעון
- Values: שכר ממוצע → Average

**תוצאה:** טבלה בצורת מטריצה – מחוז × רבעון.

### Pivot 3: מדד אי-שוויון בין מחוזות

- Rows: מחוז
- Values (3 פעמים!):
  - שכר ממוצע → Average
  - אבטלה → Average
  - תוצר → Sum

---

## חלק ז – Slicers: ממשק סינון ויזואלי

Slicer הוא כפתורי סינון ויזואליים שמחוברים ל-Pivot Table.

1. לחץ בתוך Pivot Table שלך
2. PivotTable Analyze → Insert Slicer
3. סמן: מחוז ✅ → OK

עכשיו מופיעות כפתורות לכל מחוז. לחיצה מסננת את ה-Pivot!

**Timeline (לנתוני תאריך):**
1. PivotTable Analyze → Insert Timeline
2. בחר עמודת רבעון → OK

מציג slider שמאפשר לבחור טווח זמן ויזואלית.

---

## חלק ח – גרפים מקצועיים

### עקרון: גרף טוב מספר סיפור בלי הסבר

**5 כללים לגרף כלכלי מקצועי:**
1. **כותרת ברורה:** "צמיחת תמ"ג ישראל 2018-2024" – לא "Chart 1"
2. **ציר Y עם יחידות:** %, מיליארד ₪, מדד
3. **מקור נתונים:** "מקור: בנק ישראל"
4. **לא יותר מדי צבעים:** 1-3 צבעים מקסימום
5. **ללא 3D:** גרפים תלת-ממדיים מעוותים תפיסה

### גרף 1: Combo Chart (קו + עמודות)

הצג ריבית (עמודות) + אינפלציה (קו) על אותו גרף:

1. סמן נתוני שנה + ריבית + אינפלציה
2. Insert → Charts → Recommended Charts → Combo
3. שנה ריבית ל-Clustered Column ואינפלציה ל-Line with Markers
4. עיצב:
   - צבע ריבית: כחול כהה
   - צבע אינפלציה: אדום
   - הוסף Secondary Axis לאינפלציה (אם ההתפלגות שונה)

### גרף 2: Bar Chart השוואתי

שכר ממוצע לפי מחוז (נתונים מה-Pivot):

1. סמן את Pivot Table של שכר לפי מחוז
2. Insert → Bar Chart (Horizontal)
3. מיין את הנתונים מגבוה לנמוך לפני יצירת הגרף

**עיצוב:**
```
כותרת: "פערי שכר בין מחוזות ישראל – 2022"
Data Labels: כן (לראות את המספרים)
Legend: בטל (יש רק סדרה אחת)
Gridlines: רק אופקיות, דקות
```

### גרף 3: Scatter Plot כלכלי

היחס בין שכר ממוצע לאבטלה לפי מחוז:

1. סמן עמודת שכר + עמודת אבטלה (לפי מחוז)
2. Insert → Scatter → Scatter
3. כל נקודה = מחוז

**הוסף תוויות:**
- לחץ ימין על נקודה → Add Data Label
- עצב: Label Contains → Value From Cells → בחר עמודת שם המחוז

**שאלה כלכלית:** האם יש קשר שלילי בין שכר לאבטלה? (כן – זה פיליפס-קרב בינמחוזי!)

---

## משימות השבוע

### משימה 1: VLOOKUP מורכב (25 נקודות)

צור גיליון `housing_merge`:
- עמודה א: שם מחוז
- עמודה ב: אבטלה ממוצעת (מ-districts_quarterly באמצעות AVERAGEIF)
- עמודה ג: מחיר דיור ממוצע (המציא ערכים סבירים לטבלה נפרדת, ואחזר עם VLOOKUP)
- עמודה ד: יחס אבטלה/מחיר דיור

### משימה 2: Pivot Table דו-ממדי (35 נקודות)

צור Pivot Table:
- שורות: מחוז
- עמודות: רבעון (Q1, Q2, Q3, Q4)
- ערכים: ממוצע שכר

הוסף:
- Slicer לסינון לפי שנה
- עיצוב: הפוך ל-Tabular form + הסר Subtotals

### משימה 3: גרף לפרסום (40 נקודות)

בנה גרף Combo (ריבית + אינפלציה) שמוכן ל**פרזנטציה**:
- כותרת ברורה בעברית
- צבעים עקביים
- ציר Y כפול (secondary axis)
- הוסף תיבת טקסט שמציינת "עידן הריבית הגבוהה" ומסמן 2022-2024
- מקור נתונים בתחתית

---

## הגשה

```
Members/YourName/Week_03/
├── macro_intermediate.xlsx    ← כל הגיליונות + Pivots + גרפים
└── week03_summary.md          ← 5 תובנות כלכליות שגילית
```

**בקובץ הסיכום:**
```markdown
# סיכום שבוע 3 – Excel Intermediate

## 5 תובנות מהנתונים
1. [פערי שכר בין מחוזות] ...
2. [קשר שכר-אבטלה] ...
3. [שינוי לאורך 2022] ...
4. [מחוז עם האבטלה הגבוהה ביותר] ...
5. [מחוז עם הצמיחה המהירה ביותר] ...

## אתגרים שנתקלתי בהם
- ...

## כישורים שרכשתי
- VLOOKUP / INDEX-MATCH
- Pivot Tables
- Conditional Formatting
```

---

**השבוע הבא:** Excel מתקדם – Power Query, NPV/IRR, ודשבורד מאקרו-כלכלי → [שבוע 4](../Week_04_Excel_Advanced/README.md)

### 💻 תרגול מעשי (Hands-on)

<p>לחצו על המשולש (Play) כדי להפעיל את סביבת הפיתוח בתוך העמוד, או פתחו בלשונית חדשה לנוחות מירבית.</p>
<iframe src="https://colab.research.google.com/github/econlabppe-cloud/econlabppe/blob/main/Assignments/Week_03_Excel_Intermediate/starter_notebook.ipynb" width="100%" height="600" frameborder="0" allowfullscreen></iframe>
<p><br><em>* אם המסך לא נטען או מבקש הרשאות אבטחה, <a href="https://colab.research.google.com/github/econlabppe-cloud/econlabppe/blob/main/Assignments/Week_03_Excel_Intermediate/starter_notebook.ipynb" target="_blank">לחצו כאן לפתיחת המחברת במסך מלא</a>.</em></p>
---
### 🧠 בחן את עצמך (שאלות סיכום)
הגענו לכלים החזקים של אקסל. בדקו את עצמכם:

<details>
<summary><b>שאלה 1: למה Pivot Table (טבלת ציר) היא כלי חובה לניתוח נתונים?</b> 👁️ לחץ לתשובה</summary>
<br>
Pivot Table מאפשרת לנו לקחת עשרות אלפי שורות של נתונים גולמיים (למשל, פירוט עסקאות יומי) ולסכם אותם תוך שניות לפי קטגוריות (למשל, סך הכנסות לפי חודש או לפי מוצר), בלי לכתוב אף נוסחה מסובכת.
</details>

<details>
<summary><b>שאלה 2: מדוע שילוב הפונקציות INDEX ו-MATCH (או XLOOKUP) עדיף על VLOOKUP?</b> 👁️ לחץ לתשובה</summary>
<br>
בניגוד ל-VLOOKUP, שילוב של INDEX/MATCH (או שימוש ב-XLOOKUP החדשה) מאפשר לחפש ערכים בכל כיוון (גם ימינה וגם שמאלה), הוא אינו נשבר אם מוסיפים או מוחקים עמודות באמצע הטבלה, והוא יעיל ומהיר יותר בחישובים על קבצים גדולים.
</details>


---

### 💬 הערות, שאלות ודיונים
יש לכם שאלה על החומר של פרק זה? משהו לא עבד במחברת התרגול? מצאתם דרך יעילה יותר לכתוב את הקוד?
**כתבו לנו כאן למטה!** המערכת מחוברת ישירות לגיטהאב של הקורס. כל שאלה שתשאלו כאן תישמר אוטומטית בצורה מסודרת תחת נושא זה, והצוות (או סטודנטים אחרים) יוכלו לענות לכם ולעזור.
